<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Expense Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{font-family:system-ui;background:#f5f7fb;margin:0}
.container{max-width:600px;margin:auto;padding:16px}
.card{background:#fff;padding:14px;border-radius:12px;margin-bottom:14px}
table{width:100%;border-collapse:collapse}
th,td{padding:8px;border-bottom:1px solid #ddd;text-align:left}
th{background:#f1f5f9}
input,select,button{width:100%;padding:12px;margin-bottom:10px}
button{background:#2563eb;color:#fff;border:none}
.small{padding:4px 8px;font-size:12px;width:auto}
</style>
</head>

<body>
<div class="container">

<h2>ðŸ’¸ Expense Tracker</h2>

<div class="card">
<input type="hidden" id="expenseId">
<input type="date" id="date">
<input id="enteredBy" placeholder="Entered By">
<select id="category">
<option value="">Category</option>
<option>Food</option><option>Fast Food</option><option>Drinks</option>
<option>Fuel</option><option>Cab</option><option>Hotel</option><option>Others</option>
</select>
<select id="location">
<option value="">Location</option>
<option>UP</option><option>DOWN</option><option>PrayagRaj</option>
<option>Ayodhya</option><option>Varanasi</option>
<option>Chtrakoot</option><option>Ujjain (Indore)</option><option>Others</option>
</select>
<input id="desc" placeholder="Description">
<input id="amount" type="number">
<input id="invoice" type="file">
<button onclick="save()">Save Expense</button>
</div>

<div class="card">
<b>Last 10 Expenses</b>
<table id="recentTbl"></table>
</div>

<div class="card">
<b>Summary (This Month)</b>
<div id="summary"></div>
</div>

<div class="card">
<b>Download PDF</b>
<input type="date" id="from">
<input type="date" id="to">
<button onclick="downloadPDF()">Download PDF</button>
</div>

</div>

<script>
const API="https://script.google.com/macros/s/AKfycbxTEUuXm_thvDv9BbKbfRWjPRt7rFxIPiVlGXC7_FqjD24DFvOh0fNsTeIPPXoutqpqcQ/exec";
date.valueAsDate=new Date();

function save(){
  const d={
    action:expenseId.value?"EDIT":"ADD",
    expenseId:expenseId.value,
    date:date.value,enteredBy:enteredBy.value,
    category:category.value,location:location.value,
    description:desc.value,amount:amount.value
  };
  const f=invoice.files[0];
  if(f){
    const r=new FileReader();
    r.onload=()=>{d.invoiceBase64=r.result;send(d)};
    r.readAsDataURL(f);
  } else send(d);
}

function send(d){
  fetch(API,{method:"POST",body:JSON.stringify(d)})
  .then(()=>{load();expenseId.value="";});
}

function load(){
  fetch(API,{method:"POST",body:JSON.stringify({action:"LIST"})})
  .then(r=>r.json()).then(d=>{
    let rows=d.slice(-10).reverse();
    let h="<tr><th>Category</th><th>Location</th><th>Amount</th></tr>";
    rows.forEach(r=>{
      h+=`<tr onclick='edit("${r[0]}",${JSON.stringify(r)})'>
        <td>${r[3]}</td><td>${r[4]}</td><td>â‚¹${r[6]}</td></tr>`;
    });
    recentTbl.innerHTML=h;
  });

  fetch(API,{method:"POST",body:JSON.stringify({action:"SUMMARY"})})
  .then(r=>r.json()).then(d=>{
    summary.innerHTML =
      buildTable(d.category,"Category") +
      "<br>" +
      buildTable(d.location,"Location");
  });
}

function buildTable(obj,label){
  let h=`<table><tr><th>${label}</th><th>Amount</th></tr>`;
  Object.keys(obj).sort((a,b)=>obj[b]-obj[a]).forEach(k=>{
    h+=`<tr><td>${k}</td><td>â‚¹${obj[k]}</td></tr>`;
  });
  return h+"</table>";
}

function edit(id,r){
  expenseId.value=id;
  date.value=r[1];enteredBy.value=r[2];
  category.value=r[3];location.value=r[4];
  desc.value=r[5];amount.value=r[6];
}

function downloadPDF(){
  fetch(API,{method:"POST",body:JSON.stringify({
    action:"PDF",from:from.value,to:to.value
  })}).then(r=>r.text()).then(b=>{
    const a=document.createElement("a");
    a.href="data:application/pdf;base64,"+b;
    a.download="Expense_Report.pdf";
    a.click();
  });
}

load();
</script>
</body>
</html>
